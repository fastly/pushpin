[global]
include={libdir}/internal.conf

# directory to save runtime files
rundir=run

# prefix for zmq ipc specs
ipc_prefix=pushpin-

# port offset for zmq tcp specs and http control server
port_offset=0

# TTL (seconds) for connection stats
stats_connection_ttl=120

# whether to send individual connection stats
stats_connection_send=true


[runner]
# services to start
services=connmgr,proxy,handler

# plain HTTP port to listen on for client connections
http_port=7999

# list of HTTPS ports to listen on for client connections (you must have certs set)
#https_ports=443

# list of unix socket paths to listen on for client connections
#local_ports={rundir}/{ipc_prefix}server

# directory to save log files
logdir=log

# logging level. 2 = info, >2 = verbose
log_level=2

# client full request header must fit in this buffer
client_buffer_size=2000000

# maximum number of client connections
client_maxconn=50000

# whether connections can use compression
allow_compression=false

# paths
mongrel2_bin=mongrel2
m2sh_bin=m2sh
zurl_bin=zurl


[proxy]
# routes config file (path relative to location of this file)
routesfile=routes

# enable debug mode to get informative error responses
debug=false

# whether to use automatic CORS and JSON-P wrapping
auto_cross_origin=false

# whether to accept x-forwarded-proto
accept_x_forwarded_protocol=false

# whether to assert x-forwarded-proto
set_x_forwarded_protocol=proto-only

# how to treat x-forwarded-for. example: "truncate:0,append"
x_forwarded_for=

# how to treat x-forwarded-for if grip-signed
x_forwarded_for_trusted=

# the following headers must be marked in order to qualify as orig
orig_headers_need_mark=

# whether to accept Pushpin-Route header
accept_pushpin_route=false

# value to append to the CDN-Loop header
cdn_loop=

# include client IP address in logs
log_from=false

# include client user agent in logs
log_user_agent=false

# for signing proxied requests
sig_iss=pushpin

# for signing proxied requests. use "base64:" prefix for binary key
sig_key=changeme

# use this to allow grip to be forwarded upstream (e.g. to fanout.io)
upstream_key=

# for the sockjs iframe transport
sockjs_url=http://cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js

# updates check has three modes:
#   report: check for new pushpin version and report anonymous usage info to
#           the pushpin developers
#   check:  check for new pushpin version only, don't report anything
#   off:    don't do any reporting or checking
# pushpin will output a log message when a new version is available. report
# mode helps the pushpin project build credibility, so please enable it if you
# enjoy this software :)
updates_check=off

# use this field to identify your organization in updates requests. if left
# blank, updates requests will be anonymous
organization_name=


[handler]
# ipc permissions (octal)
#ipc_file_mode=777

# bind PULL for receiving publish commands
push_in_spec=tcp://127.0.0.1:5560

# list of bind SUB for receiving published messages
push_in_sub_specs=tcp://127.0.0.1:5562

# whether the above SUB socket should connect instead of bind
push_in_sub_connect=false

# addr/port to listen on for receiving publish commands via HTTP
push_in_http_addr=127.0.0.1
push_in_http_port=5561

# maximum headers and body size in bytes when receiving publish commands via HTTP
push_in_http_max_headers_size=10000
push_in_http_max_body_size=1000000

# bind PUB for sending stats (metrics, subscription info, etc)
stats_spec=ipc://{rundir}/{ipc_prefix}stats

# bind REP for responding to commands
command_spec=tcp://127.0.0.1:5563

# max messages per second
message_rate=2500

# max rate-limited messages
message_hwm=25000

# set to report blocks counts in stats (content size / block size)
#message_block_size=

# max time (milliseconds) for out-of-order messages to wait
message_wait=5000

# time (seconds) to cache message ids
id_cache_ttl=60

# max subscriptions per connection
connection_subscription_max=20

# time (seconds) to linger response mode subscriptions
subscription_linger=60

# TTL (seconds) for subscription stats
stats_subscription_ttl=60

# interval (seconds) to send report stats
stats_report_interval=10

# stats output format
stats_format=tnetstring


[cache]
cache_enable=true
http_backend_urls=http://localhost:7999/ws1,http://localhost:7999/ws2,http://localhost:7999/ws3,http://localhost:7999/ws4,http://localhost:7999/ws5
ws_backend_urls=ws://localhost:7999/ws1
#,ws://localhost:7999/ws2,ws://localhost:7999/ws3,ws://localhost:7999/ws4,ws://localhost:7999/ws5
ws_cache_methods=*
#author_hasKey,author_hasSessionKeys,author_insertKey,author_pendingExtrinsics,author_removeExtrinsic,author_rotateKeys,author_submitExtrinsic,babe_epochAuthorship,beefy_getFinalizedHead,chain_getBlock,chain_getBlockHash,chain_getFinalizedHead,chain_getHeader,childstate_getKeys,childstate_getKeysPaged,childstate_getStorage,childstate_getStorageEntries,childstate_getStorageHash,childstate_getStorageSize,contracts_call,contracts_getStorage,contracts_instantiate,contracts_rentProjection,contracts_upload_code,dev_getBlockStats,engine_createBlock,engine_finalizeBlock,eth_accounts,eth_blockNumber,eth_call,eth_chainId,eth_coinbase,eth_estimateGas,eth_feeHistory,eth_gasPrice,eth_getBalance,eth_getBlockByHash,eth_getBlockByNumber,eth_getBlockTransactionCountByHash,eth_getBlockTransactionCountByNumber,eth_getCode,eth_getFilterChanges,eth_getFilterLogs,eth_getLogs,eth_getProof,eth_getStorageAt,eth_getTransactionByBlockHashAndIndex,eth_getTransactionByBlockNumberAndIndex,eth_getTransactionByHash,eth_getTransactionCount,eth_getTransactionReceipt,eth_getUncleByBlockHashAndIndex,eth_getUncleCountByBlockHash,eth_getUncleCountByBlockNumber,eth_getWork,eth_hashrate,eth_maxPriorityFeePerGas,eth_mining,eth_newBlockFilter,eth_newFilter,eth_newPendingTransactionFilter,eth_protocolVersion,eth_sendRawTransaction,eth_sendTransaction,eth_submitHashrate,eth_submitWork,eth_syncing,eth_uninstallFilter,net_listening,net_version,web3_clientVersion,web3_sha3,grandpa_proveFinality,grandpa_roundState,mmr_generateBatchProof,mmr_generateProof,offchain_localStorageGet,offchain_localStorageSet,payment_queryFeeDetails,payment_queryInfo,rpc_methods,state_call,state_getChildKeys,state_getChildReadProof,state_getChildStorage,state_getChildStorageHash,state_getChildStorageSize,state_getKeys,state_getKeysPaged,state_getMetadata,state_getPairs,state_getReadProof,state_getRuntimeVersion,state_getStorage,state_getStorageHash,state_getStorageSize,state_queryStorage,state_queryStorageAt,state_traceBlock,state_trieMigrationStatus,sync_state_genSyncSpec,system_accountNextIndex,system_addLogFilter,system_addReservedPeer,system_chain,system_chainType,system_dryRun,system_health,system_localListenAddresses,system_localPeerId,system_name,system_networkState,system_nodeRoles,system_peers,system_properties,system_removeReservedPeer,system_reservedPeers,system_resetLogFilter,system_syncState,system_version
ws_subscribe_methods=author_submitAndWatchExtrinsic+author_unwatchExtrinsic,beefy_subscribeJustifications+beefy_unsubscribeJustifications,chain_subscribeAllHeads+chain_unsubscribeAllHeads,chain_subscribeFinalisedHeads+chain_unsubscribeFinalisedHeads,chain_subscribeFinalizedHeads+chain_unsubscribeFinalizedHeads,chain_subscribeNewHead+chain_unsubscribeNewHead,chain_subscribeNewHeads+chain_unsubscribeNewHeads,chain_subscribeRuntimeVersion+chain_unsubscribeRuntimeVersion,grandpa_subscribeJustifications+grandpa_unsubscribeJustifications,state_subscribeRuntimeVersion+state_unsubscribeRuntimeVersion,state_subscribeStorage+state_unsubscribeStorage,transaction_unstable_submitAndWatch+transaction_unstable_unwatch
ws_never_timeout_methods=chain_getBlockHash,chain_getBlock,chain_getHeader,state_queryStorageAt
ws_refresh_shorter_methods=chain_getBlockHash,chain_getHeader,state_getKeysPaged,state_queryStorageAt
ws_refresh_longer_methods=state_getMetadata
ws_refresh_unerase_methods=chain_getBlockHash,system_health,eth_getBalance
ws_refresh_exclude_methods=state_getMetadata
ws_refresh_passthrough_methods=state_getStorage

# cache key
ws_cache_key = $request_json_value["method"] + $user_defined["request_args"]+$request_json_pair["jsonrpc"]
request_args = $request_json_value["params"]
message_id_attribute="id"
message_method_attribute="method"
message_params_attribute="params"
# redis
redis_enable=true
redis_host_addr=127.0.0.1
redis_port=6379
